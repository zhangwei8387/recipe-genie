# 产品需求说明书（Product Requirements Document） - RecipeGenie

> 版本：v1.0（草案）
> 最后更新：2025-12-27
> 维护者：@zhangwei8387

## 1. 概述
- 项目名称：RecipeGenie
- 目标：构建面向健康饮食者与上班族的 AI 驱动实时交互式食谱推荐平台，提供基于食材、时间与营养目标的可执行菜谱与交互式调整能力。

## 2. 问题陈述
- 用户痛点：不知道如何利用现有食材、时间有限或需满足营养目标时缺少快速可靠的推荐。
- 业务目标：提高用户日活、留存与用户参与度；为订阅/个性化服务创造转化路径。

## 3. 目标用户
- 🥗 健康饮食者 — 关注营养、卡路里与膳食结构
- 👔 上班族 — 时间有限、追求效率
- 兼顾其他用户群体（喜欢探索、家庭烹饪者等）

## 4. 核心场景（优先级）
1. 📦 食材反推食谱（冰箱里有 X，能做什么？）
2. ⏰ 时间限制推荐（30 分钟内/20 分钟内）
3. 💪 营养目标匹配（如高蛋白、低脂）
4. 🎭 口味/菜系偏好（例如 川菜、日料）
5. 🤔 智能探索（用户不知道吃什么时的探索推荐）

## 5. 核心功能与验收标准
### 5.1 食材反推食谱（优先级：高）
- 描述：用户输入/选择若干食材，系统返回按相关度/可行性排序的候选食谱。
- 验收标准：
  - 输入后 **<= 3 秒** 返回 Top 5 候选；至少包含：标题、食材匹配度、步骤、预计时长、营养概览（卡路里、蛋白/脂/碳水）。
  - 搜索结果中 Top1 的“可执行性”在抽样测试中 ≥ 90%（人工评估）。
  - UI 显示缺失的关键食材并建议替换项。

### 5.2 时间限制推荐（优先级：高）
- 描述：按用户设定时间返回适配的菜谱。
- 验收标准：
  - 能正确识别并标注准备/烹饪时间，按时间过滤后 Top 5 符合时间约束。
  - 边界条件测试（例如 10 分钟、90 分钟）均能返回合理候选。

### 5.3 营养目标匹配（优先级：中）
- 描述：按用户设定的营养目标（卡路里/蛋白/脂/碳水）过滤或推荐。
- 验收标准：
  - 推荐显示完整营养成分，误差控制在第三方营养数据库范围内（例如 ±10%）。
  - 用例验证：给定高蛋白目标，返回的推荐中 80% 满足设定阈值。

### 5.4 实时交互与对话式调整（优先级：高）
- 描述：用户可通过自然语言或交互式控件修改食谱（替换食材、减少油量、调整份量），UI 与营养数据实时更新。
- 验收标准：
  - 对话修改后 **<= 2 秒** 更新食谱和营养数据（本地缓存/快速计算）。
  - 支持常见替换（例如 肉 → 植物蛋白）并能提示过敏/不兼容食材。

### 5.5 AI 生成菜品图片（非 MVP）
- 描述：为推荐菜谱生成示例图片属于后续功能，不在当前 MVP 范围；作为后续迭代评估其价值与实现成本。

### 5.6 用户研究发现与采纳（已纳入验收）
- 来源：`docs/requirements/user_interviews/` 与 `docs/requirements/user_stories.md`
- 发现要点（初步）：
  - 示例用户每周做饭 3–4 次，偏好炒菜，单次约 1 小时；因此推荐应支持按菜式偏好与时间优先级排序。
  - 在“冰箱有食材”场景，部分用户倾向使用“灵感/随机推荐”以节省时间，偏好快速、步骤简洁的选项。
  - 在替换建议（如“鸡肉→豆腐”）中，用户主要关心营养差异，也兼顾时间与口感，且期望替换建议与常见搭配匹配（符合习惯搭配）。
- 采纳的变更（验收标准更新）：
  - 增加“灵感/随机推荐”模式：应在 2–3 分钟内生成简洁、低门槛的可执行方案（步骤少、准备材料少）。
  - 替换操作须显示营养对比（卡路里/蛋白/脂/碳水）、烹饪时间/步骤差异与口感提示，并至少提供 2 个常见搭配建议；支持“按营养优先/按搭配优先”两种策略。
  - 在时间约束（例如 20–30 分钟）下，推荐应优先展示 2–3 步即可开始的简易食谱。

### 5.7 AI 实时交互式菜谱界面（MVP）
- 目标：实现一个可交互的菜谱界面（Recipe View）与侧边 AI 聊天面板（Chat Panel），允许用户通过自然语言修改食谱（替换食材、调整油量/份量等），并在页面上实时显示更新后的食材、步骤和营养信息。

- 主要功能（MVP 范围）：
  - 菜谱视图：标题、食材卡片、步骤列表、营养概览（卡路里、蛋白、脂、碳水）。
  - 右侧聊天面板：用户输入自然语言指令；AI 返回修改建议并触发界面更新。
  - 基础指令支持（示例）：
    - 替换食材（示例："把鸡肉换成豆腐"）→ 替换食材 + 更新营养 + 给出口感/搭配提示。
    - 调整做法（示例："减少油量"）→ 更新步骤与热量估算。
  - 变更历史：记录每次交互（prompt 与结果）并保存至 `docs/ai-prompts/` 用于审计与复现。
  - Mock AI 服务：在初期使用规则/映射的本地 Mock 实现以快速验证 UX；真实模型接入属于后续计划并需要独立的安全与性能评估。

- 验收标准（可自动或手动验证）：
  - 功能性：发送指令后，页面在**1–2 秒**内反映变更（允许短暂延迟，初版可容忍最高 3s）。
  - 替换示例：对“把鸡肉换成豆腐”指令，食材列表对应替换、营养显示发生可解释变化、展示至少 1 条搭配提示。
  - 调整示例：“减少油量”能改变步骤文本并在营养概览中反映卡路里下降。
  - 可追踪性：每次交互保存 prompt、上下文快照与生成结果到 `docs/ai-prompts/`（`prompt.md`、`generated_files.txt`、`reviewer`、`tests_passed`）。
  - 覆盖测试：新增单元测试覆盖关键的转换函数、API 测试（POST `/api/recipes/{id}/transform`），以及一条简单的 E2E 流程测试（用户输入指令并验证界面变更）。

- 实现说明（MVP 范围，非技术栈约束）：
  - 前端应提供可交互的菜谱视图组件与聊天面板，能够渲染食材、步骤和营养信息，并在接收到变更结果后更新视图。
  - 后端应提供变换 API（例如 POST `/api/recipes/{id}/transform`），返回修改后的 recipe 对象与变更摘要；API 的具体实现技术栈可由团队后续决定。
  - 数据以可序列化的 Recipe JSON 模型存储（包括 id、title、ingredients、steps、nutrition 等字段），MVP 可采用简单的文件或内存存储用于验证。
  - AI 行为在 MVP 期使用本地 Mock 规则引擎或脚本化转换函数来实现确定性行为和可测试性；真实模型接入属于后续工作并需要独立的安全与性能评估。

- 交付物与里程碑（MVP）：
  - M1（2 周）: 前端交互视图 + Mock Transform API + ChatPanel 基本联动；包含至少 2 个示例指令的演示。
  - M2（4 周）: 增加变更历史保存、测试用例与简单 UX 微调（prompt 保存与审查注记）。

- 后续计划（非 MVP）：
  - 将真实 AI 模型接入视为后续迭代（需安全评审、性能测试与合规性检查）。

- 风险与缓解：
  - 风险：AI 生成的替换建议可能不准确或造成食品安全隐患；
    - 缓解：对任何涉及健康/安全的建议标注“Requires human safety review”，并在上线前有人工审核；对敏感替换（过敏源）强制要求人工确认。
  - 风险：营养估算误差；
    - 缓解：在界面上显示数据来源与置信度并限制自动决策的使用场景（例如仅作参考）。

## 6. 差异化特色（价值主张）
- 🤖 超智能对话：支持多轮指令与上下文保留
- 🎨 AI 生成菜品图片：提升视觉吸引力
- 🔄 食谱变体生成：在口味/营养/时间等维度生成变体
- 🌍 跨文化融合食谱：支持地区/菜系多样性

## 7. 用户研究与验证计划（已开始）
- 已完成（初步）：1 次匿名访谈（2025-12-27），记录：`docs/requirements/user_interviews/2025-12-27_anon_1.md`；对应用户故事已整理至 `docs/requirements/user_stories.md`。
- 初步发现（已采纳进 PRD 验收标准）：
  - 部分用户在冰箱场景中倾向使用“灵感/随机推荐”以节省时间，偏好步骤简洁的推荐。
  - 替换食材时需突出营养差异（卡路里/蛋白）并提供搭配建议与口感提示。
- 验证方法与计划：
  - 继续 10–15 次深度访谈，扩大样本覆盖（至少包含 5 名上班族与 5 名注重营养的用户）。
  - 分发 100+ 规模问卷以量化偏好（见 `survey_template.md`）。
  - 基于低保真原型进行可用性测试（每轮 5–8 位）。
- 输出：
  - 访谈记录、问卷数据与分析摘要；
  - 更新 `user_stories.md` 与 PRD 中的验收标准；
  - 将关键发现作为 Sprint 任务（在 `docs/sprints/` 中创建）。

## 8. KPI 与衡量标准
- 推荐响应时长：平均 < 1s（目标），95 百分位 < 3s
- 对话交互延迟：平均 < 2s
- 用户满意度（内置评分）：>= 4.0 / 5
- 转化（保存/开始烹饪）：首次目标 10%

## 9. 风险与缓解措施
- 风险：AI 推荐不可靠或产生不安全的烹饪建议（过敏、未煮熟食品）
  - 缓解：明确标注过敏原、烹饪温度/时间建议，并在早期强制人工审核重要建议。
- 风险：外部营养数据库不一致
  - 缓解：采用权威数据源并在 UI 中展示数据来源与置信度

## 10. 依赖与里程碑（MVP）
- 依赖（MVP）：营养数据（可使用 mock 数据集）、简单持久化（文件/数据库）与审计日志存储。
- 初始里程碑（MVP）：
  - M1（2 周）：实现前端交互视图、Mock Transform API 与 Chat 面板联动，实现至少 2 个示例指令演示。
  - M2（4 周）：实现交互日志保存、测试套件与 UX 微调，完成内部验收并准备下一阶段计划。

- 后续计划（非 MVP）：
  - 接入真实 AI 模型、图像生成与更大规模的营养数据集需作为后续迭代并进行安全/合规评估。

## 11. 可交付物（MVP）
- 前端交互组件（菜谱视图与聊天面板）
- 后端 Mock Transform 服务与 API 文档
- 示例数据与 prompt/response 保存样例（用于审计与复现）
- 测试套件（单元测试、API 测试、至少一条 E2E 流程测试）
- 内部演示（展示至少 2 个示例指令的可运行演示）

---

**备注**：请基于以上草案补充具体的用户研究结果、验收测试用例与原型链接，文档版本将随迭代更新.